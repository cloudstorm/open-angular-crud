# How to run the demo application locally

1. Clone the repository
2. Make sure you have `docker` and `docker-compose` available
3. Navigate to `examples/todo-list`
4. execute `docker-compose build`. This will take a while.
5. execute `docker-compose up -d`
6. execute `docker-compose run --rm web bundle exec rake db:migrate`
7. execute `docker-compose run --rm web bundle exec rake rails_bower:install`
8. execute `docker-compose up -d` again, it will re-create the web container and restart it.

The app should be available on `docker_machine_ip:port` where `docker_machine_ip` is the IP address of the docker host, and `port` is 3000 (as specified in the docker-compose.yml file)

## Known issues

### The rails web server cannot start
Symptom:
```
web_1 | A server is already running. Check /home/app/tmp/pids/server.pid.
web_1 | => Booting WEBrick
web_1 | => Rails 4.2.7.1 application starting in development on http://0.0.0.0:3000
web_1 | => Run `rails server -h` for more startup options
web_1 | => Ctrl-C to shutdown server
web_1 | Exiting
todolist_web_1 exited with code 1
```
Solution:

Delete the `/home/app/tmp/pids/server.pid` file inside the web container and restart it.

# Cloudstorm rails generators

## Model generator

Usage example:
`rails generate cloudstorm:model Item title:string description:string due_date:date done:boolean`

Usage example inside docker container:
`docker-compose run --rm web bundle exec rails generate cloudstorm:model Item title:string description:string due_date:date done:boolean`

### Files created by the generator

#### app/models/item.rb

Creates a simple ActiveRecord model.
```
class Item < ActiveRecord::Base
end

```

#### app/controllers/api/v1/items_controller.rb

A simple controler for the generated model, inheriting from the cloudstorm `API::APIController`.
```
class API::V1::ItemsController < API::APIController
  set_resource_type Item
end

```

#### app/serializers/item_serializer.rb

A simple serializer inheriting from the cloudstorm `ApiSerializer`.
```
class ItemSerializer < ApiSerializer
  # Whitelist all attributes
  def attributes(requested_attrs = nil, reload = false)
    object.attributes
  end
end

```

#### app/assets/javascripts/resources/item.js.coffee

Angular module representing the model.
```
angular.module('todoList.resources.item', ['cloudstorm.rest-api'])
.factory 'itemsResource', ['ResourceService', 'csRestApi', 'csResource', (ResourceService, csRestApi, csResource) ->

  class Item extends csResource

    @endpoint = 'api/v1/items'
    @member_endpoint = 'api/v1/items/{id}'

    @descriptor = {
      type: 'items'
      name: 'Item'
      hint: 'BLANK'

      fields: [
        { attribute: 'title', label: 'title', type: 'string', cardinality: 'one', required: true, read_only: false }
        { attribute: 'description', label: 'description', type: 'string', cardinality: 'one', required: false, read_only: false }
        { attribute: 'due_date', label: 'due_date', type: 'date', cardinality: 'one', required: true, read_only: false }
        { attribute: 'done', label: 'done', type: 'boolean', cardinality: 'one', required: false, read_only: false, default: false }
      ]
    }

  ResourceService.register(Item.descriptor.type, Item)

  return Item

]
```

#### app/assets/javascripts/controllers/itemCtrl.js.coffee

Angular controller for the resource.
```
"use strict"

angular.module("todoList", []).controller "ItemCtrl", [ "$scope", ($scope) ->
  $scope.resourceType = "items"
]
```


### Files modified by the generator

#### app/config/routes.rb
Routes for the new model will be added to the application routes.
```
namespace :api do
  namespace :v1 do
    resources :items <- This will be added
  end
end
```
#### app/assets/javascripts/resources/resources.js.coffee
Add the newly generated angular resource module to the list of resources.
```
app = angular.module('todoList.resources', [
  'todoList.resources.item' <- This wil be added
])

```
#### app/assets/javascripts/applications/todoList.js.coffee

## Cloudstorm initializer

Usage example:
`rails generate cloudstorm:install`

Usage example inside docker container:
`docker-compose run --rm web bundle exec rails generate cloudstorm:install`

### Files generated by the generator

#### app/assets/javascripts/resources/resources.js.coffee
#### app/assets/javascripts/templates/todo_list_index_base-html-haml
#### app/assets/javascripts/applications/todoList.js.coffee
#### app/controllers/api/api_controller.rb
#### app/serializers/api_serializer.rb
